---
- name: Include vars
  ansible.builtin.include_vars:
    file: ../../../../vars/main.yml

# pg_probackup[0].value
- name: Setting origin_pg_probackup_command_value
  ansible.builtin.set_fact: # yamllint disable rule:line-length
    origin_pg_probackup_command_value: "pg_probackup-{{ pg_probackup_version }} restore -B {{ pg_probackup_dir }} --instance {{ pg_probackup_instance }} -j {{ pg_probackup_threads }} {{ pg_probackup_add_keys }}"

- name: Debug pg_probackup[0].value
  ansible.builtin.debug:
    var: pg_probackup[0].value

- name: Assert pg_probackup[0].value
  ansible.builtin.assert:
    that:
      - pg_probackup[0].value == origin_pg_probackup_command_value
    fail_msg: >
      Assertion failed: pg_probackup[0].value is "{{ pg_probackup[0].value }}",
      but expected "{{ origin_pg_probackup_command_value}}"
    success_msg: "pg_probackup[0].value is correct"


# pg_probackup_patroni_cluster_bootstrap_command
- name: Setting host facts using complex arguments
  ansible.builtin.set_fact: # yamllint disable rule:line-length
    origin_pg_probackup_patroni_cluster_bootstrap_command: "pg_probackup-{{ pg_probackup_version }} restore -B {{ pg_probackup_dir }} --instance {{ pg_probackup_instance }} -j {{ pg_probackup_threads }} {{ pg_probackup_add_keys }}"

- name: Debug pg_probackup_patroni_cluster_bootstrap_command
  ansible.builtin.debug:
    var: pg_probackup_patroni_cluster_bootstrap_command

- name: Assert pg_probackup_patroni_cluster_bootstrap_command
  ansible.builtin.assert:
    that:
      - pg_probackup_patroni_cluster_bootstrap_command == origin_pg_probackup_patroni_cluster_bootstrap_command
    fail_msg: >
      Assertion failed: pg_probackup_patroni_cluster_bootstrap_command is "{{ pg_probackup_patroni_cluster_bootstrap_command }}",
      but expected "{{ origin_pg_probackup_patroni_cluster_bootstrap_command }}"
    success_msg: "pg_probackup_patroni_cluster_bootstrap_command is correct"
