---
# üöÄ These tasks aim to test the _baseurl variable
# üéØ The objective is to guarantee that the urls are correctly set

# ========================================
# üíª Start OracleLinux Operations and Tests
# ========================================

# üîÑ Define a valid OracleLinux
- name: Molecule.tests.variables.asserts.baseurl | Set OracleLinux Test Data (valid)
  run_once: true
  ansible.builtin.set_fact:
    postgrespro_minor_version: 12.4.1
    ansible_distribution_major_version: 9

# üìù Establishing test data for OracleLinux
- name: Molecule.tests.variables.asserts.baseurl | Establish OracleLinux Test Data
  run_once: true
  ansible.builtin.set_fact:
    _baseurl:
      OracleLinux: >-
        {{ 'https://repo.postgrespro.ru//pgpro-archive/pgpro-' ~
        postgrespro_minor_version ~ '/oraclelinux/' ~
        ansible_distribution_major_version ~ 'Server/os/x86_64/rpms/' }}

# üñ®Ô∏è Debugging the established OracleLinux
- name: Molecule.tests.variables.asserts.baseurl | Debug OracleLinux
  run_once: true
  ansible.builtin.debug:
    var: _baseurl['OracleLinux']

# ‚úÖ Verifying the correctness of the established OracleLinux
# If the OracleLinux is not set, the test fails and an error message is displayed
- name: Molecule.tests.variables.asserts.baseurl | Verify OracleLinux
  run_once: true
  ansible.builtin.assert:
    that:
      - "'OracleLinux' in _baseurl"
      - "_baseurl['OracleLinux'] is not none"
      - "_baseurl['OracleLinux'] != 'N/A'"
      - "_baseurl['OracleLinux'] == 'https://repo.postgrespro.ru//pgpro-archive/pgpro-12.4.1/oraclelinux/9Server/os/x86_64/rpms/'"
    fail_msg: "Test failed: OracleLinux is not set correctly in _baseurl."
    success_msg: "Test passed: OracleLinux is set correctly in _baseurl."
